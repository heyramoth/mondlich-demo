(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();var F=1e-6,z=typeof Float32Array<"u"?Float32Array:Array,gt=Math.PI/180;function ft(e){return e*gt}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function dt(){var e=new z(9);return z!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function ut(){var e=new z(16);return z!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function mt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function it(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Q(e,t,r){var s=t[0],i=t[1],a=t[2],n=t[3],o=t[4],c=t[5],g=t[6],u=t[7],f=t[8],m=t[9],d=t[10],x=t[11],v=t[12],p=t[13],E=t[14],P=t[15],A=r[0],w=r[1],C=r[2],y=r[3];return e[0]=A*s+w*o+C*f+y*v,e[1]=A*i+w*c+C*m+y*p,e[2]=A*a+w*g+C*d+y*E,e[3]=A*n+w*u+C*x+y*P,A=r[4],w=r[5],C=r[6],y=r[7],e[4]=A*s+w*o+C*f+y*v,e[5]=A*i+w*c+C*m+y*p,e[6]=A*a+w*g+C*d+y*E,e[7]=A*n+w*u+C*x+y*P,A=r[8],w=r[9],C=r[10],y=r[11],e[8]=A*s+w*o+C*f+y*v,e[9]=A*i+w*c+C*m+y*p,e[10]=A*a+w*g+C*d+y*E,e[11]=A*n+w*u+C*x+y*P,A=r[12],w=r[13],C=r[14],y=r[15],e[12]=A*s+w*o+C*f+y*v,e[13]=A*i+w*c+C*m+y*p,e[14]=A*a+w*g+C*d+y*E,e[15]=A*n+w*u+C*x+y*P,e}function q(e,t,r){var s=r[0],i=r[1],a=r[2],n,o,c,g,u,f,m,d,x,v,p,E;return t===e?(e[12]=t[0]*s+t[4]*i+t[8]*a+t[12],e[13]=t[1]*s+t[5]*i+t[9]*a+t[13],e[14]=t[2]*s+t[6]*i+t[10]*a+t[14],e[15]=t[3]*s+t[7]*i+t[11]*a+t[15]):(n=t[0],o=t[1],c=t[2],g=t[3],u=t[4],f=t[5],m=t[6],d=t[7],x=t[8],v=t[9],p=t[10],E=t[11],e[0]=n,e[1]=o,e[2]=c,e[3]=g,e[4]=u,e[5]=f,e[6]=m,e[7]=d,e[8]=x,e[9]=v,e[10]=p,e[11]=E,e[12]=n*s+u*i+x*a+t[12],e[13]=o*s+f*i+v*a+t[13],e[14]=c*s+m*i+p*a+t[14],e[15]=g*s+d*i+E*a+t[15]),e}function pt(e,t,r){var s=t[0],i=t[1],a=t[2],n=t[3],o=s+s,c=i+i,g=a+a,u=s*o,f=s*c,m=s*g,d=i*c,x=i*g,v=a*g,p=n*o,E=n*c,P=n*g;return e[0]=1-(d+v),e[1]=f+P,e[2]=m-E,e[3]=0,e[4]=f-P,e[5]=1-(u+v),e[6]=x+p,e[7]=0,e[8]=m+E,e[9]=x-p,e[10]=1-(u+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function vt(e,t,r,s,i){var a=1/Math.tan(t/2),n;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(n=1/(s-i),e[10]=(i+s)*n,e[14]=2*i*s*n):(e[10]=-1,e[14]=-2*s),e}var xt=vt;function At(e,t,r,s){var i,a,n,o,c,g,u,f,m,d,x=t[0],v=t[1],p=t[2],E=s[0],P=s[1],A=s[2],w=r[0],C=r[1],y=r[2];return Math.abs(x-w)<F&&Math.abs(v-C)<F&&Math.abs(p-y)<F?it(e):(u=x-w,f=v-C,m=p-y,d=1/Math.hypot(u,f,m),u*=d,f*=d,m*=d,i=P*m-A*f,a=A*u-E*m,n=E*f-P*u,d=Math.hypot(i,a,n),d?(d=1/d,i*=d,a*=d,n*=d):(i=0,a=0,n=0),o=f*n-m*a,c=m*i-u*n,g=u*a-f*i,d=Math.hypot(o,c,g),d?(d=1/d,o*=d,c*=d,g*=d):(o=0,c=0,g=0),e[0]=i,e[1]=o,e[2]=u,e[3]=0,e[4]=a,e[5]=c,e[6]=f,e[7]=0,e[8]=n,e[9]=g,e[10]=m,e[11]=0,e[12]=-(i*x+a*v+n*p),e[13]=-(o*x+c*v+g*p),e[14]=-(u*x+f*v+m*p),e[15]=1,e)}function S(){var e=new z(3);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function D(e){var t=new z(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function wt(e){var t=e[0],r=e[1],s=e[2];return Math.hypot(t,r,s)}function O(e,t,r){var s=new z(3);return s[0]=e,s[1]=t,s[2]=r,s}function V(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function U(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function $(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function tt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function G(e,t){var r=t[0],s=t[1],i=t[2],a=r*r+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Ct(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function N(e,t,r){var s=t[0],i=t[1],a=t[2],n=r[0],o=r[1],c=r[2];return e[0]=i*c-a*o,e[1]=a*n-s*c,e[2]=s*o-i*n,e}function Mt(e,t,r){var s=t[0],i=t[1],a=t[2],n=r[3]*s+r[7]*i+r[11]*a+r[15];return n=n||1,e[0]=(r[0]*s+r[4]*i+r[8]*a+r[12])/n,e[1]=(r[1]*s+r[5]*i+r[9]*a+r[13])/n,e[2]=(r[2]*s+r[6]*i+r[10]*a+r[14])/n,e}var yt=wt;(function(){var e=S();return function(t,r,s,i,a,n){var o,c;for(r||(r=3),s||(s=0),i?c=Math.min(i*r+s,t.length):c=t.length,o=s;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],a(e,e,n),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2];return t}})();function Et(){var e=new z(4);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Pt(e,t){var r=t[0],s=t[1],i=t[2],a=t[3],n=r*r+s*s+i*i+a*a;return n>0&&(n=1/Math.sqrt(n)),e[0]=r*n,e[1]=s*n,e[2]=i*n,e[3]=a*n,e}(function(){var e=Et();return function(t,r,s,i,a,n){var o,c;for(r||(r=4),s||(s=0),i?c=Math.min(i*r+s,t.length):c=t.length,o=s;o<c;o+=r)e[0]=t[o],e[1]=t[o+1],e[2]=t[o+2],e[3]=t[o+3],a(e,e,n),t[o]=e[0],t[o+1]=e[1],t[o+2]=e[2],t[o+3]=e[3];return t}})();function Y(){var e=new z(4);return z!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function at(e,t,r){r=r*.5;var s=Math.sin(r);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(r),e}function H(e,t,r,s){var i=t[0],a=t[1],n=t[2],o=t[3],c=r[0],g=r[1],u=r[2],f=r[3],m,d,x,v,p;return d=i*c+a*g+n*u+o*f,d<0&&(d=-d,c=-c,g=-g,u=-u,f=-f),1-d>F?(m=Math.acos(d),x=Math.sin(m),v=Math.sin((1-s)*m)/x,p=Math.sin(s*m)/x):(v=1-s,p=s),e[0]=v*i+p*c,e[1]=v*a+p*g,e[2]=v*n+p*u,e[3]=v*o+p*f,e}function Tt(e,t){var r=t[0]+t[4]+t[8],s;if(r>0)s=Math.sqrt(r+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var a=(i+1)%3,n=(i+2)%3;s=Math.sqrt(t[i*3+i]-t[a*3+a]-t[n*3+n]+1),e[i]=.5*s,s=.5/s,e[3]=(t[a*3+n]-t[n*3+a])*s,e[a]=(t[a*3+i]+t[i*3+a])*s,e[n]=(t[n*3+i]+t[i*3+n])*s}return e}var nt=Pt;(function(){var e=S(),t=O(1,0,0),r=O(0,1,0);return function(s,i,a){var n=Ct(i,a);return n<-.999999?(N(e,t,i),yt(e)<1e-6&&N(e,r,i),G(e,e),at(s,e,Math.PI),s):n>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(N(e,i,a),s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1+n,nt(s,s))}})();(function(){var e=Y(),t=Y();return function(r,s,i,a,n,o){return H(e,s,n,o),H(t,i,a,o),H(r,e,t,2*o*(1-o)),r}})();(function(){var e=dt();return function(t,r,s,i){return e[0]=s[0],e[3]=s[1],e[6]=s[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],nt(t,Tt(t,e))}})();var zt=Object.defineProperty,ot=e=>{throw TypeError(e)},Rt=(e,t,r)=>t in e?zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t,r)=>Rt(e,typeof t!="symbol"?t+"":t,r),ht=(e,t,r)=>t.has(e)||ot("Cannot "+r),l=(e,t,r)=>(ht(e,t,"read from private field"),r?r.call(e):t.get(e)),R=(e,t,r)=>t.has(e)?ot("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),k=(e,t,r,s)=>(ht(e,t,"write to private field"),t.set(e,r),r);class It{constructor({viewConfig:t,projectionConfig:r}){h(this,"_viewConfig"),h(this,"_projectionConfig"),h(this,"_worldMatrix"),h(this,"_viewMatrix"),h(this,"_projectionMatrix"),this._viewConfig={eye:D(t.eye),center:D(t.center),up:D(t.up)},this._projectionConfig={...r},this._worldMatrix=new Float32Array(16),this._viewMatrix=new Float32Array(16),this._projectionMatrix=new Float32Array(16),this.updateMatrices()}updateMatrices(){it(this._worldMatrix),At(this._viewMatrix,this._viewConfig.eye,this._viewConfig.center,this._viewConfig.up),xt(this._projectionMatrix,this._projectionConfig.fovy,this._projectionConfig.aspect,this._projectionConfig.nearPlane,this._projectionConfig.farPlane)}setEyePosition(t){V(this._viewConfig.eye,t),this.updateMatrices()}setLookAt(t){V(this._viewConfig.center,t),this.updateMatrices()}setUpVector(t){V(this._viewConfig.up,t),this.updateMatrices()}moveEye(t){U(this._viewConfig.eye,this._viewConfig.eye,t),this.updateMatrices()}moveLookAt(t){U(this._viewConfig.center,this._viewConfig.center,t),this.updateMatrices()}setFovy(t){this._projectionConfig.fovy=t,this.updateMatrices()}setAspect(t){this._projectionConfig.aspect=t,this.updateMatrices()}setNearPlane(t){this._projectionConfig.nearPlane=t,this.updateMatrices()}setFarPlane(t){this._projectionConfig.farPlane=t,this.updateMatrices()}get worldMatrix(){return this._worldMatrix}get viewMatrix(){return this._viewMatrix}get projectionMatrix(){return this._projectionMatrix}get eyePosition(){return this._viewConfig.eye}get lookAtPoint(){return this._viewConfig.center}get upVector(){return this._viewConfig.up}}const bt={eye:[0,1500,1e3],center:[0,1100,0],up:[0,1,0]},St={fovy:ft(100),aspect:1,nearPlane:.1,farPlane:5e4},et=60,Bt={alpha:!1,antialias:!0,depth:!0,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"};class Lt{constructor(t,r={}){h(this,"camera"),h(this,"gl"),this.canvas=t;const s=t.getContext("webgl2",{...Bt,...r});if(!s)throw new Error("WebGL2 is not supported in this browser.");this.gl=s,this.camera=new It({viewConfig:bt,projectionConfig:{...St,aspect:t.width/t.height}})}get viewportSize(){return{width:this.canvas.width,height:this.canvas.height}}}class Dt{constructor(t){this.engine=t}get viewportSize(){return this.engine.viewportSize}get cameraWorldMatrix(){return this.engine.camera.worldMatrix}get cameraViewMatrix(){return this.engine.camera.viewMatrix}get cameraProjectionMatrix(){return this.engine.camera.projectionMatrix}get cameraMatrix(){const t=new Float32Array(16);return Q(t,t,this.engine.camera.projectionMatrix),Q(t,t,this.engine.camera.viewMatrix),mt(t,this.engine.camera.worldMatrix),t}get gl(){return this.engine.gl}executeInGLContext(t){t(this.engine.gl)}}class K{constructor(t=!0){h(this,"startTime"),h(this,"oldTime"),h(this,"elapsedTime"),h(this,"running"),this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,t&&this.start()}start(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;const r=(typeof performance>"u"?Date:performance).now();return this.running&&(t=(r-this.oldTime)/1e3,this.elapsedTime+=t,this.oldTime=r),t}get isRunning(){return this.running}}class kt{constructor(){h(this,"current"),h(this,"particles"),this.current=0,this.particles=[]}add(t){this.current++,this.current===this.particles.length&&(this.current=0),this.particles[this.current].alive=!0,this.particles[this.current].x=t.x,this.particles[this.current].y=t.y,this.particles[this.current].z=t.z,this.particles[this.current].vy=t.vy||0,this.particles[this.current].vz=t.vz||0,this.particles[this.current].vx=t.vx||0,this.particles[this.current].size=t.size||1,this.particles[this.current].life=t.life||1,this.particles[this.current].mass=t.mass||1,this.particles[this.current].decay=t.decay||10,this.particles[this.current].gravity=t.gravity||-9.82,this.particles[this.current].color[0]=t.r||1,this.particles[this.current].color[1]=t.g||1,this.particles[this.current].color[2]=t.b||1,this.particles[this.current].condition=t.condition||(()=>!1),this.particles[this.current].action=t.action||(()=>{}),this.particles[this.current].effect=t.effect||(()=>{}),t.onCreate&&t.onCreate(this.particles[this.current])}}class Ft{constructor(t){h(this,"i"),h(this,"x"),h(this,"y"),h(this,"z"),h(this,"vx"),h(this,"vy"),h(this,"vz"),h(this,"mass"),h(this,"alive"),h(this,"size"),h(this,"color"),h(this,"decay"),h(this,"life"),h(this,"gravity"),h(this,"condition"),h(this,"action"),h(this,"effect"),this.i=t,this.x=0,this.y=0,this.z=0,this.vx=0,this.vy=0,this.vz=0,this.mass=0,this.alive=!1,this.size=0,this.color=[1,1,1],this.decay=0,this.life=0,this.gravity=-9.82,this.condition=()=>!1,this.action=()=>{},this.effect=()=>{}}update(t,r){this.life-=t,this.size-=t*this.decay;const s=.47,i=1.22,a=Math.PI/1e4;let n=-.5*s*a*i*this.vx*this.vx*this.vx/Math.abs(this.vx),o=-.5*s*a*i*this.vz*this.vz*this.vz/Math.abs(this.vz),c=-.5*s*a*i*this.vy*this.vy*this.vy/Math.abs(this.vy);n=isNaN(n)?0:n,c=isNaN(c)?0:c,o=isNaN(o)?0:o;const g=n/this.mass,u=this.gravity+c/this.mass,f=o/this.mass;this.vx+=g*t,this.vy+=u*t,this.vz+=f*t,this.x+=this.vx*t*100,this.z+=this.vz*t*100,this.y+=this.vy*t*100,this.condition(this,t,r)&&(this.action(this,t,r),this.reset()),this.effect(this,t,r),(this.life<=0||this.size<=0)&&this.reset()}reset(){this.x=0,this.y=0,this.z=0,this.mass=0,this.alive=!1,this.size=0,this.decay=0,this.vx=0,this.vy=0,this.vz=0,this.life=0}}class ct{}class J extends ct{update(t){t.updateParticles()}}class Nt{constructor({particleSystem:t,particlesCount:r,spawnFramespan:s}){h(this,"_isActive",!0),h(this,"_activeParticlesCount",0),h(this,"pool"),h(this,"particleSystem"),h(this,"spawnFramespan"),h(this,"timer"),h(this,"particlesCount"),h(this,"frameDelta",0),h(this,"spawnCounter",0),h(this,"data"),this.pool=new kt,this.timer=new K(!1),this.particleSystem=t,this.particlesCount=r,this.spawnFramespan=s,this.data={positions:new Float32Array(r*3),colors:new Float32Array(r*3),sizes:new Float32Array(r)},this.initPool()}initPool(){for(let t=0;t<this.particlesCount;t++){const r=new Ft(t);this.pool.particles.push(r)}}async update(t){return this.timer.isRunning?(t||new J).update(this):Promise.resolve()}updateParticles(){const t=Date.now()*.001;for(this.frameDelta+=this.timer.getDelta(),this.spawnFramespan&&(this.spawnCounter+=1,this.spawnCounter>this.spawnFramespan&&(this.particleSystem.launch(this.pool),this.spawnCounter=0));this.frameDelta>=1/et;){this._activeParticlesCount=0;for(let r=0,s=0,i=0;r<this.particlesCount;r++){const a=this.pool.particles[r];a.alive&&(a.update(this.frameDelta,t),this.data.positions[s++]=a.x,this.data.positions[s++]=a.y,this.data.positions[s++]=a.z,this.data.colors[i++]=a.color[0],this.data.colors[i++]=a.color[1],this.data.colors[i++]=a.color[2],this.data.sizes[r]=a.size,a.alive&&this._activeParticlesCount++)}this.frameDelta-=1/et}}start(){this.timer.start()}stop(){this.timer.stop()}get isActive(){return this._isActive}set isActive(t){if(this._isActive=t,t){this.start();return}this.stop()}get activeParticlesCount(){return this._activeParticlesCount}get settings(){return this.particleSystem.settings}}class Wt{constructor({gl:t,shaderProgram:r,elementsCount:s}){h(this,"gl"),h(this,"shaderProgram"),h(this,"elementsCount"),h(this,"vertexBuffers",new Map),h(this,"indexBufferConfig",null),h(this,"textures",new Map),this.gl=t,this.shaderProgram=r,this.elementsCount=s}createVertexBuffer({name:t,data:r,attributeConfig:s,usage:i=this.gl.STATIC_DRAW}){const a=this.gl.createBuffer();if(!a)throw new Error("Failed to create vertex buffer");this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,i),this.vertexBuffers.set(t,{buffer:a,data:r,attributeConfig:s,usage:i})}createVertexBuffers(t){t.forEach(({name:r,data:s,attributeConfig:i,usage:a=this.gl.STATIC_DRAW})=>{this.createVertexBuffer({name:r,data:s,attributeConfig:i,usage:a})})}createIndexBuffer({data:t,usage:r=this.gl.STATIC_DRAW}){const s=this.gl.createBuffer();if(!s)throw new Error("Failed to create index buffer");this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,s),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,t,r),this.indexBufferConfig={buffer:s,data:t,usage:r}}enableVertexBuffer(t){if(!this.shaderProgram.program)throw new Error("Shader program not found");const r=this.vertexBuffers.get(t);if(!r)throw new Error(`Vertex buffer ${t} not found`);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,r.data,r.usage);const s=this.gl.getAttribLocation(this.shaderProgram.program,t);if(s===-1){console.log(`Attribute ${t} not found. Skipping...`);return}this.gl.enableVertexAttribArray(s),this.gl.vertexAttribPointer(s,r.attributeConfig.size,r.attributeConfig.type,r.attributeConfig.normalized,r.attributeConfig.stride,r.attributeConfig.offset)}enableAllVertexBuffers(){this.vertexBuffers.forEach((t,r)=>{this.enableVertexBuffer(r)})}enableIndexBuffer(){this.indexBufferConfig&&(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBufferConfig.buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBufferConfig.data,this.indexBufferConfig.usage))}createTexture({name:t,unit:r,source:s=null,width:i=1,height:a=1}){const n=this.gl.createTexture();if(!n)throw new Error("Failed to create texture");this.gl.activeTexture(this.gl.TEXTURE0+r),this.gl.bindTexture(this.gl.TEXTURE_2D,n),s?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,s):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,i,a,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.textures.set(t,{texture:n,unit:r})}bindTextures(){this.textures.forEach(({texture:t,unit:r},s)=>{this.gl.activeTexture(this.gl.TEXTURE0+r),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.shaderProgram.setInt(s,r)})}disableAllVertexBuffers(){this.vertexBuffers.forEach((t,r)=>{const s=this.gl.getAttribLocation(this.shaderProgram.program,r);s!==-1&&this.gl.disableVertexAttribArray(s)})}disableIndexBuffer(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null)}disableTextures(){this.textures.forEach(({unit:t})=>{this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,null)})}dispose(){this.vertexBuffers.forEach(t=>this.gl.deleteBuffer(t)),this.indexBufferConfig&&this.gl.deleteBuffer(this.indexBufferConfig.buffer),this.textures.forEach(({texture:t})=>this.gl.deleteTexture(t))}get hasIndexBuffer(){return this.indexBufferConfig!==null}get program(){return this.shaderProgram}}class Ot{constructor(t){this.adapter=t,this.adapter=t}render(t){this.adapter&&this.adapter.executeInGLContext(r=>{t.shaderProgram.use(),t.shaderProgram.updateUniforms(this.adapter),this.draw({gl:r,renderData:t}),t.shaderProgram.disable()})}draw({gl:t,renderData:r}){r.bindTextures(),r.enableAllVertexBuffers(),r.hasIndexBuffer?(r.enableIndexBuffer(),t.drawElements(t.TRIANGLES,r.elementsCount,t.UNSIGNED_SHORT,0),r.disableIndexBuffer()):t.drawArrays(t.POINTS,0,r.elementsCount),r.disableAllVertexBuffers(),r.disableTextures()}}var M,I,b,L,W,j,_,X,Z,T;class Ut{constructor(t,r,s){R(this,M,null),R(this,I,null),R(this,b,null),R(this,L,new Map),R(this,W),R(this,j,()=>{k(this,I,this.glContext.createShader(this.glContext.VERTEX_SHADER)),k(this,b,this.glContext.createShader(this.glContext.FRAGMENT_SHADER))}),R(this,_,()=>{if(!l(this,I))throw new Error("Vertex shader not found");if(!l(this,b))throw new Error("Fragment shader not found");if(this.glContext.shaderSource(l(this,I),this.vertexShaderSource),this.glContext.shaderSource(l(this,b),this.fragmentShaderSource),this.glContext.compileShader(l(this,I)),!this.glContext.getShaderParameter(l(this,I),this.glContext.COMPILE_STATUS)){console.error("ERROR compiling vertex shader!",this.glContext.getShaderInfoLog(l(this,I)));return}if(this.glContext.compileShader(l(this,b)),!this.glContext.getShaderParameter(l(this,b),this.glContext.COMPILE_STATUS)){console.error("ERROR compiling fragment shader!",this.glContext.getShaderInfoLog(l(this,b)));return}}),R(this,X,()=>{if(!l(this,I))throw new Error("Vertex shader not found");if(!l(this,b))throw new Error("Fragment shader not found");if(k(this,M,this.glContext.createProgram()),!l(this,M))throw new Error("Error creating gl program");if(this.glContext.attachShader(l(this,M),l(this,I)),this.glContext.attachShader(l(this,M),l(this,b)),this.glContext.linkProgram(l(this,M)),!this.glContext.getProgramParameter(l(this,M),this.glContext.LINK_STATUS)){console.error("ERROR linking program!",this.glContext.getProgramInfoLog(l(this,M)));return}if(this.glContext.validateProgram(l(this,M)),!this.glContext.getProgramParameter(l(this,M),this.glContext.VALIDATE_STATUS)){console.error("ERROR validating program!",this.glContext.getProgramInfoLog(l(this,M)));return}}),R(this,Z,()=>{if(!l(this,M))throw new Error("Program not found");const i=this.glContext.getProgramParameter(l(this,M),this.glContext.ACTIVE_UNIFORMS);for(let a=0;a<i;a++){const n=this.glContext.getActiveUniform(l(this,M),a);if(!n)continue;const o=this.glContext.getUniformLocation(l(this,M),n.name);if(o){const c=n.name.replace(/\[.*?\]/,"");l(this,L).set(c,o)}}}),R(this,T,i=>{if(!l(this,M))throw new Error("Shader program not defined");const a=l(this,L).get(i);if(a)return a;const n=this.glContext.getUniformLocation(l(this,M),i);if(n===-1||n===null)throw new Error(`Uniform '${i}' not found or optimized out`);return l(this,L).set(i,n),n}),h(this,"setMat4",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniformMatrix4fv(n,!1,a)}),h(this,"setMat3",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniformMatrix3fv(n,!1,a)}),h(this,"setMat2",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniformMatrix2fv(n,!1,a)}),h(this,"setInt",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform1i(n,a)}),h(this,"setFloat",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform1f(n,a)}),h(this,"setVec2",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform2fv(n,a)}),h(this,"setVec3",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform3fv(n,a)}),h(this,"setVec4",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform4fv(n,a)}),h(this,"setIntArray",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform1iv(n,a)}),h(this,"setFloatArray",(i,a)=>{const n=l(this,T).call(this,i);this.glContext.uniform1fv(n,a)}),this.vertexShaderSource=t,this.fragmentShaderSource=r,this.glContext=s,l(this,j).call(this),l(this,_).call(this),l(this,X).call(this),this.use(),l(this,Z).call(this)}setUniformsManager(t){k(this,W,t)}updateUniforms(t){var r;(r=l(this,W))==null||r.updateUniforms({adapter:t,shader:this})}get program(){return l(this,M)}use(){this.glContext.useProgram(l(this,M))}disable(){this.glContext.useProgram(null)}cleanup(){l(this,M)&&(this.glContext.deleteProgram(l(this,M)),k(this,M,null)),l(this,L).clear()}}M=new WeakMap,I=new WeakMap,b=new WeakMap,L=new WeakMap,W=new WeakMap,j=new WeakMap,_=new WeakMap,X=new WeakMap,Z=new WeakMap,T=new WeakMap;class Vt{}class Ht{}class Gt extends Ht{constructor(t=[0,0,0],r=20,s=10,i=10,a=[1,0,0]){super(),this.origin=t,this.minParticleSize=r,this.maxParticleSize=s,this.maxParticleSizeStep=i,this.color=a}}class Yt extends Vt{constructor(){super(...arguments),h(this,"settings",new Gt)}shellEffect(t,r,s,i,a){let n=1,o=0,c=0;switch(i){case 1:n=Math.random()*30;break;case 2:t.x+=Math.cos(Math.PI*2*s)*Math.random()*3,t.z+=Math.sin(Math.PI*2*s)*Math.random()*3;break;case 3:Math.random()>.5?t.size=150:t.size=10,n=Math.random()*10,o=2-Math.random()*4,c=2-Math.random()*4;break}for(let g=0;g<n;g++)a.add({x:t.x,y:t.y,z:t.z,mass:.002,gravity:-.2,size:20+Math.random()*40,vx:o,vz:c,r:1,g:0,b:0,life:Math.random()*3,decay:50})}crackleEffect(t,r,s,i,a,n){let o=0,c=0,g=0;switch(i){case 1:break;case 2:break;case 3:o=a[0]*2,c=a[1]*2,g=a[2];break}for(let u=0;u<10+Math.random()*150;u++){const f=Math.random()*80,m=-.2,d=1-Math.random()*2,x=1-Math.random()*2,v=1-Math.random()*2,p=.1+Math.random()*2;Math.random()>.5&&i===2&&(o=a[0],c=a[1],g=a[2]),n.add({x:t.x,y:t.y,z:t.z,size:f,mass:.02,gravity:m,r:o,g:c,b:g,vy:d,vx:x,vz:v,life:p,decay:Math.random()*50})}}explodeEffect(t,r,s,i,a){for(let n=0;n<100+Math.random()*200;n++){const o=Math.random()*80,c=-.5,g=1-Math.random()*2,u=1-Math.random()*2,f=1-Math.random()*2,m=.1+Math.random();a.add({x:t.x,y:t.y,z:t.z,size:o,mass:.5,gravity:c,vy:g,vx:u,vz:f,life:m,decay:Math.random()*50})}}flairEffect(t,r,s,i,a,n,o){let c=1,g=0,u=0;switch(i){case 1:Math.random()>.5?t.size=250:t.size=10;break;case 2:t.vy<0&&(t.x+=Math.cos(Math.PI*2*s)*Math.random()*3,t.z+=Math.sin(Math.PI*2*s)*Math.random()*3);break;case 3:Math.random()>.5?t.size=150:t.size=10,Math.random()>.5&&(c=a[0],g=a[1],u=a[2]);break}n>250&&t.life<1&&Math.random()<.05&&(this.crackleEffect(t,r,s,i,a,o),t.reset()),o.add({x:t.x,y:t.y,z:t.z,mass:.002,gravity:-.2,size:20+Math.random()*40,r:c,g,b:u,life:Math.random()*3,decay:50})}launch(t){const r=this.settings.origin,s=this.settings.color,i=this.settings.minParticleSize+Math.random()*Math.min(350,this.settings.maxParticleSize);this.settings.maxParticleSize+=this.settings.maxParticleSizeStep;const a=Math.random()*4|0;t.add({effect:(n,o,c)=>{this.shellEffect(n,o,c,a,t)},x:r[0],y:r[1],z:r[2],size:i,mass:.5,vz:0,vx:0,vy:10+Math.min(i/30,7),r:s[0],g:s[1],b:s[2],life:20,decay:10+Math.random()*20,condition:n=>n.vy<=-Math.random()*20,action:(n,o,c)=>{this.explodeEffect(n,o,c,a,t);const g=-.1-Math.random()*2,u=1+Math.random()*6,f=2+Math.random()*2,m=2/i,d=Math.PI*(3-Math.sqrt(5));for(let x=0;x<i;x++){let v,p,E;switch(a){case 1:p=Math.abs(x*m-1+m/2);const P=Math.sqrt(1-Math.pow(p,2)),A=(x+1)%i*d;v=Math.cos(A)*P,E=Math.sin(A)*P,v*=f,p*=f,E*=f;break;case 2:p=1+Math.random()*2,v=Math.sin(x*Math.PI*2*f)*(2-Math.random()*4),E=Math.sin(x*Math.PI*2*f)*(2-Math.random()*4);break;default:p=x*m-1+m/2;const w=Math.sqrt(1-Math.pow(p,2)),C=(x+1)%i*d;v=Math.cos(C)*w,E=Math.sin(C)*w,v*=f,p*=f,E*=f;break}t.add({effect:(P,A,w)=>{this.flairEffect(P,A,w,a,s,i,t)},x:n.x,y:n.y,z:n.z,size:i,mass:.001,gravity:g,vy:p,vz:E,vx:v,r:s[0],g:s[1],b:s[2],life:.5+Math.random()*u,decay:Math.random()*100})}}})}}const jt="data:image/png;base64,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";class _t{constructor(){h(this,"textureCache",new Map)}async loadImage(t,r){const s=this.textureCache.get(r);if(s)return s;const i=new Image;return i.crossOrigin="anonymous",i.src=r,await i.decode(),this.textureCache.set(t,i),i}getTexture(t){const r=this.textureCache.get(t);if(!r)throw new Error(`Texture with id "${t}" not loaded.`);return r}loadTextureLibrary(){return Promise.all([this.loadImage("spark",jt)])}}class Xt{}const Zt=`#version 300 es
precision highp float;
layout(location = 0) in vec3 aPosition;
layout(location = 1) in vec3 aColor;
layout(location = 2) in float aSize;

uniform mat4 mWorld;
uniform mat4 mView;
uniform mat4 mProj;

out vec3 fragColor;

void main() {
  fragColor = aColor;
  vec4 pos = mView * mWorld * vec4(aPosition, 1.0);
  gl_PointSize = aSize * ( 300.0 / -pos.z );
  gl_Position = mProj * pos;
}
`,Kt=`#version 300 es
precision highp float;

in vec3 fragColor;
out vec4 outColor;

uniform sampler2D u_pointTexture;

void main() {
  outColor = vec4(fragColor, 1.0) * texture(u_pointTexture, gl_PointCoord);
}
`,B={aPosition:{attrSize:3},aColor:{attrSize:3},aSize:{attrSize:1}};class Jt extends Xt{updateUniforms({adapter:t,shader:r}){r.setMat4("mWorld",t.cameraWorldMatrix),r.setMat4("mView",t.cameraViewMatrix),r.setMat4("mProj",t.cameraProjectionMatrix)}}const Qt=e=>{const t=new Ut(Zt,Kt,e),r=new Jt;return t.setUniformsManager(r),t},qt=e=>{const t=new Wt({gl:e.gl,shaderProgram:e.shader,elementsCount:e.effect.particlesCount});return t.createVertexBuffers([{name:"aPosition",data:e.effect.data.positions,attributeConfig:{size:B.aPosition.attrSize,type:e.gl.FLOAT,normalized:!1,stride:B.aPosition.attrSize*Float32Array.BYTES_PER_ELEMENT,offset:0}},{name:"aColor",data:e.effect.data.colors,attributeConfig:{size:B.aColor.attrSize,type:e.gl.FLOAT,normalized:!1,stride:B.aColor.attrSize*Float32Array.BYTES_PER_ELEMENT,offset:0}},{name:"aSize",data:e.effect.data.sizes,attributeConfig:{size:B.aSize.attrSize,type:e.gl.FLOAT,normalized:!1,stride:B.aSize.attrSize*Float32Array.BYTES_PER_ELEMENT,offset:0}}]),t.createTexture({name:"u_pointTexture",source:e.htmlTexture,unit:0}),t};class $t{constructor(t){h(this,"worker"),h(this,"taskCount",0),this.worker=new Worker(t)}postMessage(t){return this.taskCount++,new Promise(r=>{this.worker.onmessage=s=>{this.taskCount--,r(s.data)},this.worker.postMessage(t)})}get busyness(){return this.taskCount}}class te{constructor(t,r=navigator.hardwareConcurrency||4){h(this,"workers",[]),h(this,"workerScript"),this.workerScript=t,this.workers=Array.from({length:r},()=>new $t(t))}getLeastBusyWorker(){return this.workers.reduce((t,r)=>t.busyness<r.busyness?t:r)}}class ee extends ct{constructor(t){super(),this.worker=t}async update(t){const r={positions:t.data.positions,colors:t.data.colors,sizes:t.data.sizes,frameDelta:t.frameDelta,spawnCounter:t.spawnCounter,particlesCount:t.particlesCount,spawnFramespan:t.spawnFramespan,activeParticlesCount:t.activeParticlesCount},s=await this.worker.postMessage(r);t.data.positions.set(s.positions),t.data.colors.set(s.colors),t.data.sizes.set(s.sizes),t.frameDelta=s.frameDelta,t.spawnCounter=s.spawnCounter,t._activeParticlesCount=s.activeParticlesCount}}class re{constructor(t){h(this,"workerContexts",new WeakMap),this.workerManager=t}setWorkerEnabled(t,r){if(r){const s=this.workerManager.getLeastBusyWorker();this.workerContexts.set(t,new ee(s))}else this.workerContexts.delete(t)}getContext(t){return this.workerContexts.get(t)||new J}}const rt=10;class se{constructor(t,r){h(this,"contextManager"),h(this,"renderer"),h(this,"effectsData",new Map),h(this,"textureManager",new _t),this.adapter=t,this.renderer=new Ot(t),r&&(this.contextManager=new re(new te(r)))}addEffect(t,r){this.effectsData.set(t,r)}deleteEffect(t){const r=this.effectsData.get(t);r&&(r.dispose(),this.effectsData.delete(t))}setWorkerEnabled(t,r){var s;(s=this.contextManager)==null||s.setWorkerEnabled(t,r)}async update(){const t=Array.from(this.effectsData.keys()).map(r=>{var s;const i=((s=this.contextManager)==null?void 0:s.getContext(r))||new J;return r.update(i)});await Promise.all(t)}render(){this.effectsData.forEach((t,r)=>{r.isActive&&r.activeParticlesCount>0&&this.renderer.render(t)})}createEffect(t){const r=new Nt({particlesCount:t.particlesCount,particleSystem:t.system,spawnFramespan:t.spawnFramespan||rt}),s=t.createRenderData(r);return this.addEffect(r,s),r}createFirework(t){const r=new Yt,s=Qt(this.adapter.gl),i=this.textureManager.getTexture("spark");return this.createEffect({system:r,particlesCount:t.particlesCount,spawnFramespan:t.spawnFramespan||rt,createRenderData:a=>qt({gl:this.adapter.gl,shader:s,effect:a,htmlTexture:i})})}}class lt{static randomInRange(t,r){return Math.random()*(r-t)+t}static rotatePointAroundAxis({point:t,axisOrigin:r,axisDirection:s,rotationAngle:i}){const a=Y();at(a,s,i);const n=ut();q(n,n,[-r[0],-r[1],-r[2]]),pt(n,a,[0,0,0]),q(n,n,r);const o=S();return Mt(o,t,n),o}constructor(){}}class ie{constructor({camera:t,sensitivity:r=1,moveSpeed:s=100,rotateSpeed:i=2,worldUpVector:a=O(0,1,0)}){h(this,"camera"),h(this,"timer"),h(this,"sensitivity"),h(this,"isDragging"),h(this,"lastX"),h(this,"lastY"),h(this,"worldUpVector"),h(this,"moveSpeed"),h(this,"rotateSpeed"),h(this,"keys"),this.camera=t,this.timer=new K,this.sensitivity=r,this.isDragging=!1,this.lastX=0,this.lastY=0,this.worldUpVector=a,this.moveSpeed=s,this.rotateSpeed=i,this.keys={KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1},this.setupEventListeners()}setupEventListeners(){document.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this))}onMouseDown(t){this.isDragging=!0,this.lastX=t.clientX,this.lastY=t.clientY}onMouseMove(t){if(!this.isDragging)return;const r=t.clientX-this.lastX,s=t.clientY-this.lastY,i=r*this.sensitivity,a=s*this.sensitivity,n=D(this.camera.lookAtPoint);U(n,n,[i,-a,0]),this.camera.setLookAt(n),this.lastX=t.clientX,this.lastY=t.clientY}onMouseUp(){this.isDragging=!1}update(){const t=this.timer.getDelta();this.handleKeyboardInput(t)}handleKeyboardInput(t){const r=S();$(r,this.camera.lookAtPoint,this.camera.eyePosition),G(r,r);const s=S();if(N(s,r,this.camera.upVector),G(s,s),this.keys.KeyW){const i=tt(S(),r,this.moveSpeed*t);this.camera.moveEye(i),this.camera.moveLookAt(i)}if(this.keys.KeyS){const i=tt(S(),r,-this.moveSpeed*t);this.camera.moveEye(i),this.camera.moveLookAt(i)}this.keys.KeyA&&this.rotateCamera(this.rotateSpeed*t),this.keys.KeyD&&this.rotateCamera(-this.rotateSpeed*t)}rotateCamera(t){const r=D(this.camera.eyePosition),s=D(this.camera.lookAtPoint),i=S();$(i,s,r);const a=lt.rotatePointAroundAxis({point:i,axisOrigin:[0,0,0],axisDirection:this.worldUpVector,rotationAngle:t}),n=S();U(n,r,a),this.camera.setLookAt(n)}isEventCodeInKeys(t){return t in this.keys}onKeyDown(t){t.preventDefault(),this.isEventCodeInKeys(t.code)&&(this.keys[t.code]=!0)}onKeyUp(t){t.preventDefault(),this.isEventCodeInKeys(t.code)&&(this.keys[t.code]=!1)}dispose(){document.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}}const ae={alpha:!1,antialias:!0,depth:!0,stencil:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"},ne=({width:e,height:t,containerId:r,options:s={}})=>{const i=document.getElementById(r);if(!i)throw new Error('Element with ID "app" not found');const a=document.createElement("canvas");a.width=e,a.height=t,a.style.display="block",i.appendChild(a);const n={...ae,...s},o=a.getContext("webgl2",n);if(!o)throw new Error("WebGL2 is not supported in this browser");return{canvas:a,gl:o}},oe=({gl:e,width:t,height:r})=>{e.viewport(0,0,t,r),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE),e.enable(e.CULL_FACE),e.frontFace(e.CCW),e.cullFace(e.BACK),e.clearColor(0,0,0,1)},st={width:1920,height:1080},he=async()=>{const{gl:e,canvas:t}=ne({...st,containerId:"app"});oe({gl:e,...st});const r=new Lt(t),s=new Dt(r),i=new se(s);await i.textureManager.loadTextureLibrary();const a=i.createFirework({particlesCount:2e4});a.settings.origin=[0,0,-500];const n=new K(!1),o=()=>{const f=n.getElapsedTime();a.settings.color=O(Math.random(),Math.random(),Math.random()),a.settings.origin=lt.rotatePointAroundAxis({point:a.settings.origin,axisOrigin:[0,0,0],axisDirection:[0,1,0],rotationAngle:f})},c=new ie({camera:r.camera,sensitivity:1}),g=()=>{e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),i.render()};n.start(),a.start();const u=()=>{o(),a.update(),c.update(),g(),requestAnimationFrame(u)};u()};he();
